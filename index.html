<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>Quiz Regolamento CRI - IPRP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    /* --- TUTTO IL TUO CSS ORIGINALE (invariato) --- */
    :root {
      --cri-red: #c8102e;
      --cri-red-dark: #8b0a1f;
      --bg: #f5f5f5;
      --card-bg: #ffffff;
      --text: #222222;
      --muted: #777777;
      --success: #1b873f;
      --danger: #c0392b;
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }
    body {
      background: radial-gradient(circle at top left, #ffe5e9, #f5f5f5);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      color: var(--text);
    }
    .quiz-container {
      background: var(--card-bg);
      max-width: 800px;
      width: 100%;
      border-radius: 16px;
      padding: 24px 24px 28px;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12);
    }
    .quiz-header { display: flex; justify-content: space-between; align-items: center; gap: 16px; margin-bottom: 20px; border-bottom: 1px solid #e3e3e3; padding-bottom: 12px; }
    .quiz-title { font-size: 1.25rem; font-weight: 700; color: var(--cri-red-dark); }
    .quiz-subtitle { font-size: 0.85rem; color: var(--muted); margin-top: 4px; }
    .status-badges { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
    .badge { padding: 6px 10px; border-radius: 999px; font-size: 0.8rem; font-weight: 600; display: inline-flex; align-items: center; gap: 6px; background: #f0f0f0; color: var(--muted); }
    .badge-time { background: #ffe9ec; color: var(--cri-red-dark); }
    .badge-question { background: #e9f5ff; color: #114b7a; }
    .timer-circle { width: 42px; height: 42px; border-radius: 50%; border: 3px solid var(--cri-red); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1rem; }
    .timer-warning { border-color: #e67e22; color: #e67e22; }
    .timer-danger { border-color: var(--danger); color: var(--danger); }
    .question-text { font-size: 1.05rem; font-weight: 600; margin-bottom: 16px; line-height: 1.4; }
    .answers-list { list-style: none; display: grid; gap: 10px; margin-bottom: 10px; }
    .answer-btn { width: 100%; text-align: left; border-radius: 999px; border: 1px solid #dddddd; padding: 10px 14px; font-size: 0.95rem; background: #ffffff; cursor: pointer; display: flex; align-items: center; gap: 10px; transition: all 0.16s ease; }
    .answer-btn:hover { border-color: var(--cri-red); box-shadow: 0 0 0 2px rgba(200, 16, 46, 0.08); transform: translateY(-1px); }
    .answer-btn.disabled { opacity: 0.7; cursor: default; transform: none; box-shadow: none; }
    .answer-label { width: 24px; height: 24px; border-radius: 999px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.8rem; }
    .answer-text { flex: 1; }
    .feedback { min-height: 0; font-size: 0.9rem; margin-bottom: 6px; font-weight: 500; color: transparent; }
    .quiz-footer { display: flex; justify-content: flex-end; align-items: center; margin-top: 4px; min-height: 32px; }
    .btn { border-radius: 999px; padding: 8px 16px; border: none; font-size: 0.9rem; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 6px; transition: all 0.16s ease; }
    .btn-primary { background: var(--cri-red); color: #ffffff; }
    .btn-primary:hover { background: var(--cri-red-dark); transform: translateY(-1px); box-shadow: 0 8px 18px rgba(0, 0, 0, 0.18); }
    .btn-primary:disabled { opacity: 0.5; cursor: default; transform: none; box-shadow: none; }
    .btn-next-hidden { display: none; }
    .start-screen, .result-screen { text-align: center; padding: 20px 10px 10px;}
    .start-title { font-size: 1.4rem; font-weight: 700; margin-bottom: 8px; color: var(--cri-red-dark); }
    .result-summary-textarea { width: 100%; min-height: 90px; border-radius: 8px; border: 1px solid #dddddd; padding: 8px; font-size: 0.85rem; resize: vertical; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="quiz-container">
    <div class="quiz-header">
      <div>
        <div class="quiz-title">Quiz Regolamento CRI ‚Äì IPRP</div>
        <div class="quiz-subtitle">20 domande ¬∑ 12 secondi a domanda ¬∑ Max 3 errori per superare il test</div>
      </div>
      <div class="status-badges">
        <div class="badge badge-question" id="questionCounterBadge">Domanda: 0 / 20</div>
        <div class="badge badge-time">‚è± <div class="timer-circle" id="timerCircle">12</div></div>
      </div>
    </div>

    <!-- Schermata iniziale -->
    <div class="start-screen" id="startScreen">
      <div class="start-title">Sei pronto a diventare un medico modello?</div>
      <div class="start-text">
        Rispondi alle domande sul regolamento.<br />
        Hai 12 secondi per ogni domanda.<br />
        Massimo 3 errori per superare.<br />
        Al 4¬∞ errore il test termina subito.
      </div>
      <button class="btn btn-primary" id="startBtn">Inizia il quiz</button>
    </div>

    <!-- Area quiz -->
    <div id="quizArea" class="hidden">
      <div class="question-text" id="questionText"></div>
      <ul class="answers-list" id="answersList"></ul>
      <div class="feedback" id="feedback"></div>
    </div>

    <!-- Schermata risultato -->
    <div class="result-screen hidden" id="resultScreen">
      <div class="result-title">Quiz completato!</div>
      <div class="result-score" id="finalScoreText"></div>
      <div class="result-detail" id="finalDetailText"></div>
      <textarea id="resultSummary" class="result-summary-textarea" readonly></textarea>
      <div style="margin-top:8px;display:flex;justify-content:flex-end;">
        <button class="btn btn-ghost" id="copyResultBtn">Copia risultato</button>
      </div>
    </div>
  </div>

<script>
// =================== CONFIG ===================
const WEBHOOK_URL = "https://discord.com/api/webhooks/1442576209337782465/Pb8U60s6byY0eW8BliGpO3bxE-jccNDV0Mpv4amP-UPvHXGP0lTUg6SLfdnvKProW0AV";
const QUESTION_TIME = 12;
const TOTAL_QUESTIONS = 20;
const MAX_ERRORS = 3;

// üîê BLOCCO MONOUSO
if (localStorage.getItem("quizCRICompleted") === "true") {
  document.body.innerHTML = `
    <div style="text-align:center; padding:40px;">
      <h2 style="color:#c0392b;">‚ùå Test non disponibile</h2>
      <p>Questo test √® gi√† stato completato e ora √® disattivato.</p>
    </div>`;
  throw new Error("Quiz bloccato dopo uso");
}

// ================== DOMANDE (le tue) ==================
const allQuestions = [
 // BIBBIA / NEUTRALIT√Ä
      {
        question: "La Croce Rossa in citt√† √® considerata:",
        options: [
          "Una fazione militare",
          "Una fazione legale",
          "Una fazione neutrale",
          "Una fazione d‚Äôemergenza che pu√≤ schierarsi"
        ],
        correctIndex: 2
      },
      {
        question: "Cosa significa che la Croce Rossa √® una fazione NEUTRALE?",
        options: [
          "Che non pu√≤ parlare con le altre fazioni",
          "Che non parteggia per nessuno e assiste tutti",
          "Che pu√≤ schierarsi solo con le FDO",
          "Che non pu√≤ uscire dall‚Äôospedale"
        ],
        correctIndex: 1
      },
      {
        question: "Quando un medico pu√≤ intervenire durante un‚Äôazione in corso?",
        options: [
          "Subito, se vede un ferito a terra",
          "Quando riceve qualunque chiamata",
          "Solo quando l‚Äôazione √® effettivamente terminata",
          "Quando glielo chiede una delle fazioni coinvolte"
        ],
        correctIndex: 2
      },
      {
        question: "Durante un‚ÄôAZIONE IN CORSO l‚Äôoperatore sanitario deve mantenere una distanza minima di:",
        options: ["300 metri", "100 metri", "50 metri", "Non c‚Äô√® distanza minima"],
        correctIndex: 0
      },
      {
        question: "Chi deve essere rianimato per primo dopo un‚Äôazione conclusa?",
        options: [
          "Il primo che capita",
          "Chi urla pi√π forte",
          "La fazione vincente",
          "Sempre e solo le Forze dell‚ÄôOrdine"
        ],
        correctIndex: 2
      },
      {
        question: "Quando un medico viene puntato o minacciato con un‚Äôarma deve:",
        options: [
          "Ignorare la minaccia perch√© √® neutrale",
          "Continuare a curare come se nulla fosse",
          "Simulare paura e fare correttamente RP",
          "Andare subito in ospedale"
        ],
        correctIndex: 2
      },

      // CODICE NERO
      {
        question: "In quali casi un paziente √® considerato CODICE NERO secondo il regolamento?",
        options: [
          "Quando ha perso molto sangue",
          "Quando la causa di morte √® annegamento o esplosione",
          "Quando √® stato colpito da arma da fuoco a distanza ravvicinata",
          "Quando cade da una scala"
        ],
        correctIndex: 1
      },
      {
        question: "Cosa pu√≤ fare il medico con un paziente in CODICE NERO?",
        options: [
          "Provare comunque la rianimazione",
          "Lasciarlo dove si trova",
          "Trasportarlo in obitorio senza rianimarlo",
          "Portarlo in sala operatoria"
        ],
        correctIndex: 2
      },
{
  question: "In caso di annegamento o esplosione, quale codice sanitario si applica?",
  options: [
    "Codice Rosso",
    "Codice Giallo",
    "Codice Nero",
    "Codice Verde"
  ],
  correctIndex: 2
},

      // SERVIZIO / FUORI SERVIZIO
      {
        question: "Quando NON si √® in servizio √®:",
        options: [
          "Consentito rianimare ma non vendere bende",
          "Vietato rianimare",
          "Consentito tutto se in divisa",
          "Consentito usare solo l‚ÄôAutoMedica"
        ],
        correctIndex: 1
      },
      {
        question: "Per rispondere ad una chiamata √® obbligatorio:",
        options: [
          "Essere solo in radio 118",
          "Avere almeno un collega collegato",
          "Avere la divisa 118 e un mezzo di soccorso",
          "Essere in borghese per non dare nell‚Äôocchio"
        ],
        correctIndex: 2
      },
      {
        question: "Fuori servizio si possono usare i mezzi di soccorso?",
        options: [
          "No, non √® mai consentito",
          "Solo se si √® medici",
          "S√¨ ma senza accendere sirene",
          "Solo per accompagnare amici"
        ],
        correctIndex: 0
      },
      {
        question: "Per rimanere in citt√† ma NON lavorare (fuori servizio) cosa bisogna fare?",
        options: [
          "Niente, basta non andare in ospedale",
          "Compilare il modulo fuori-servizio e attendere l‚Äôesito",
          "Scrivere un messaggio in radio",
          "Togliersi la divisa e basta"
        ],
        correctIndex: 1
      },
      {
        question: "Se un operatore non compila il modulo FUORI SERVIZIO e viene trovato in giro:",
        options: [
          "Non succede nulla",
          "Riceve un premio",
          "√à soggetto a una sanzione interna",
          "Viene spostato di reparto"
        ],
        correctIndex: 2
      },
      {
        question: "In caso di assenza dalla citt√† per pi√π di 72 ore:",
        options: [
          "Non serve fare nulla",
          "Bisogna compilare il modulo assenze sull‚Äôapplicativo",
          "Bisogna avvisare un collega in privato",
          "Basta uscire dal servizio in ospedale"
        ],
        correctIndex: 1
      },

      // LICENZIAMENTO / PROMOZIONI
      {
        question: "Dal giorno di assunzione ci si pu√≤ licenziare dopo almeno:",
        options: ["2 giorni", "3 giorni", "5 giorni", "7 giorni"],
        correctIndex: 2
      },
      {
        question: "Dopo il licenziamento, in quanti giorni si pu√≤ rientrare in Croce Rossa Italiana?",
        options: ["3 giorni", "5 giorni", "7 giorni", "14 giorni"],
        correctIndex: 2
      },


      // RADIO E CHIAMATE
      {
        question: "Durante il servizio √® obbligatorio essere:",
        options: [
          "In un canale Discord qualsiasi",
          "Nel canale radio 118 corretto",
          "Solo sul telefono",
          "In silenzio radio totale"
        ],
        correctIndex: 1
      },
      {
        question: "Una delle regole base della radio √®:",
        options: [
          "Parlare tutti insieme",
          "Usare la radio solo per fare battute",
          "Comunicazioni brevi, precise e inerenti al servizio",
          "Non rispondere ai check radio"
        ],
        correctIndex: 2
      },

      // AMBULANZA E RIANIMAZIONI
      {
        question: "Durante il pattugliamento in ambulanza, come vanno tenuti i dispositivi luminosi?",
        options: [
          "Sirene e lampeggianti sempre accesi",
          "Solo sirene accese",
          "Lampeggianti fissi accesi e sirene spente",
          "Tutto spento finch√© non c‚Äô√® un morto"
        ],
        correctIndex: 2
      },
      {
        question: "In codice radio, ‚ÄúVictor‚Äù indica:",
        options: [
          "Il medico di turno",
          "L‚Äôambulanza",
          "L‚ÄôAutoMedica",
          "L‚Äôeliambulanza"
        ],
        correctIndex: 1
      },
      {
        question: "In codice radio, ‚ÄúMike‚Äù indica:",
        options: [
          "L‚Äôambulanza",
          "La Polizia",
          "L‚ÄôAutoMedica",
          "Il Pronto Soccorso"
        ],
        correctIndex: 2
      },

      // REGOLAMENTO GENERALE
      {
        question: "Chi pu√≤ utilizzare l‚Äôelisoccorso Pegaso 21?",
        options: [
          "Chiunque sia in servizio",
          "Solo la Dirigenza",
          "Solo operatori qualificati con brevetto Pegaso",
          "Solo i Primari"
        ],
        correctIndex: 2
      },
{
  question: "L‚Äôuniforme √® obbligatoria durante:",
  options: [
    "Solo durante le rianimazioni",
    "Ogni volta che si √® in servizio",
    "Solo in ospedale",
    "Solo se c‚Äô√® un responsabile"
  ],
  correctIndex: 1
},
      {
        question: "Ai gradi sotto il medico √® vietato:",
        options: [
          "Vendere bende, farmaci e fare prescrizioni",
          "Guidare l‚Äôambulanza",
          "Usare la radio",
          "Stare in pronto soccorso"
        ],
        correctIndex: 0
      },
      {
        question: "Gli operatori della Croce Rossa, riguardo ai fatti visti in servizio, possono:",
        options: [
          "Testimoniare liberamente in tribunale",
          "Registrare tutto e pubblicarlo",
          "Non possono testimoniare i fatti accaduti durante il servizio",
          "Parlare solo con i colleghi"
        ],
        correctIndex: 2
      },
      {
        question: "Il medico con fedina penale sporcata a seguito di azioni illegali:",
        options: [
          "Viene semplicemente richiamato",
          "Viene spostato di reparto",
          "Subisce sospensione di 24 ore",
          "Viene licenziato direttamente"
        ],
        correctIndex: 3
      },
      {
        question: "√à possibile richiedere soldi per la rianimazione?",
        options: [
          "S√¨, sempre",
          "S√¨, ma solo per i civili",
          "No, la rianimazione √® gratuita",
          "Solo se lo decide il Direttore Generale"
        ],
        correctIndex: 2
      },
      {
        question: "Quando √® possibile far pagare 750‚Ç¨ tramite fattura?",
        options: [
          "Per ogni visita in ospedale",
          "Per la vendita del cerotto",
          "Per ogni rianimazione",
          "Per ogni trasporto in ambulanza"
        ],
        correctIndex: 1
      },
{
  question: "Chi  paga il cerotto?",
  options: [
    "Tutti tranne FDO, CRI, VVFF",
    "Il medico di turno",
    "Lo Stato",
    "Nessuno, √® gratuito"
  ],
  correctIndex: 0
},
      {
        question: "In servizio √® consentito portare:",
        options: [
          "Qualsiasi arma da fuoco",
          "Solo pistola d‚Äôordinanza",
          "Solo armi bianche non da taglio",
          "Nessuna arma di nessun tipo, nemmeno bianche"
        ],
        correctIndex: 2
      },
      {
        question: "In servizio, riguardo l‚Äôabbigliamento, √®:",
        options: [
          "Consentito indossare maschere e cappelli che coprono il volto",
          "Consentito qualsiasi outfit",
          "Vietato coprire il volto; obbligatori gli scarponi antinfortunistici",
          "Obbligatorio avere sempre casco tattico"
        ],
        correctIndex: 2
      }
];

// ================== LOGICA QUIZ ==================
let questions = [];
let currentQuestionIndex = 0;
let score = 0;
let answeredQuestions = 0;
let timer = null;
let timeLeft = QUESTION_TIME;
let hasAnsweredCurrent = false;
let failureQuestionNumber = null;

const startScreen = document.getElementById("startScreen");
const quizArea = document.getElementById("quizArea");
const resultScreen = document.getElementById("resultScreen");
const questionText = document.getElementById("questionText");
const answersList = document.getElementById("answersList");
const questionCounterBadge = document.getElementById("questionCounterBadge");
const timerCircle = document.getElementById("timerCircle");
const finalScoreText = document.getElementById("finalScoreText");
const finalDetailText = document.getElementById("finalDetailText");
const resultSummary = document.getElementById("resultSummary");
const copyResultBtn = document.getElementById("copyResultBtn");
const startBtn = document.getElementById("startBtn");

// Funzioni quiz
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}

startBtn.addEventListener("click", startQuiz);

function startQuiz() {
  questions = shuffle(allQuestions).slice(0, TOTAL_QUESTIONS);
  startScreen.classList.add("hidden");
  quizArea.classList.remove("hidden");
  loadQuestion();
}

function loadQuestion() {
  clearInterval(timer);
  hasAnsweredCurrent = false;
  const q = questions[currentQuestionIndex];
  questionText.textContent = q.question;
  questionCounterBadge.textContent = `Domanda: ${currentQuestionIndex+1} / ${questions.length}`;
  answersList.innerHTML = "";
  q.options.forEach((opt, index) => {
    const btn = document.createElement("button");
    btn.className = "answer-btn";
    btn.textContent = opt;
    btn.addEventListener("click", () => handleAnswer(index));
    answersList.appendChild(btn);
  });
  timeLeft = QUESTION_TIME;
  startTimer();
}

function startTimer() {
  timer = setInterval(() => {
    timeLeft--;
    timerCircle.textContent = timeLeft;
    if (timeLeft <= 0) handleTimeout();
  }, 1000);
}

function handleAnswer(selectedIndex) {
  if (hasAnsweredCurrent) return;
  hasAnsweredCurrent = true;
  clearInterval(timer);
  answeredQuestions++;

  if (selectedIndex === questions[currentQuestionIndex].correctIndex) score++;

  if ((answeredQuestions - score) > MAX_ERRORS) {
    failureQuestionNumber = currentQuestionIndex + 1;
    endQuiz();
  } else {
    nextQuestion();
  }
}

function handleTimeout() {
  if (hasAnsweredCurrent) return;
  hasAnsweredCurrent = true;
  clearInterval(timer);
  answeredQuestions++;

  if ((answeredQuestions - score) > MAX_ERRORS) {
    failureQuestionNumber = currentQuestionIndex + 1;
    endQuiz();
  } else {
    nextQuestion();
  }
}

function nextQuestion() {
  if (currentQuestionIndex < questions.length - 1) {
    currentQuestionIndex++;
    loadQuestion();
  } else {
    endQuiz();
  }
}

// ================== FINE TEST ==================
function endQuiz() {
  clearInterval(timer);
  quizArea.classList.add("hidden");
  resultScreen.classList.remove("hidden");
  localStorage.setItem("quizCRICompleted", "true"); // blocca riutilizzo

  const errors = answeredQuestions - score;
  const percentage = Math.round((score / answeredQuestions) * 100);
  finalScoreText.textContent = `Corrette: ${score} su ${answeredQuestions} ¬∑ Errori: ${errors}`;

  let giudizio = errors > MAX_ERRORS
    ? `ESITO: NON SUPERATO ‚ùå\nHai raggiunto il 4¬∞ errore alla domanda n. ${failureQuestionNumber}.`
    : `ESITO: SUPERATO ‚úÖ`;

  finalDetailText.textContent = `Percentuale: ${percentage}%\n${giudizio}`;

  resultSummary.value =
    `RISULTATO QUIZ CRI\nDomande corrette: ${score}/${answeredQuestions}\nErrori: ${errors}\n${giudizio}`;

  // üì© INVIO A DISCORD
  if (WEBHOOK_URL !== "INSERISCI_QUI_IL_TUO_WEBHOOK_DISCORD") {
    fetch(WEBHOOK_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        content:
`üìã **RISULTATO TEST CRI - IPRP**
üìù Esito: ${giudizio}
üìä Corrette: ${score}/${answeredQuestions}
‚ùå Errori: ${errors}
${failureQuestionNumber ? "‚ö†Ô∏è Fallito alla domanda: "+ failureQuestionNumber : ""}
üìÖ Data: ${new Date().toLocaleString()}
üîí Test disattivato automaticamente`
      })
    });
  }
}

copyResultBtn.addEventListener("click", () => {
  resultSummary.select();
  document.execCommand("copy");
  alert("Risultato copiato negli appunti.");
});
</script>
</body>
</html>
